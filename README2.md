# <font color="Seablue">cat_app</font>

***TypeScript／Next.jsで猫画像アプリを作る学習***

***参考サイト***

https://www.youtube.com/watch?v=MZclBqhCB6A

https://qiita.com/kenRp01/items/e4a5b08d7968aba855e1

https://www.commte.co.jp/learn-nextjs/next-head

https://commte.net/nextjs-google-font

https://thecatapi.com/


- TypeScriptをメイン言語、フレームワークをNext.jsとして、アプリケーションを作っていきます。
- 任意のディレクトリに移動して、
- Next.jsの導入コマンドを叩いていきます。
- 今回はTypeScriptも一緒にインストールするオプションをつけてコマンドを実行します。
- アプリ名は参考動画と同じにします。`cat_app`
- 今回はTypeScript以外のインストールで質問された項目は全てNoにしました。
- TailwindCSSや、srcディレクトリおよびApp routeも採用していません。
- 2022年9月の動画なので、1年以上経過していて若干古いです。
- が、まずはTypeScriptをメインに開発していく過程を学ぶのが主目的であるため、
- これで進めようと思います。
- また、今回は`npx`コマンドでプロジェクトを作成しました。
- ローカルのサーバーを確認するには、コマンド`npm rnn dev`で起動します。

<br>

## <font color="Seablue">開発環境</font>


- `Next.js 14.0.4`
- `TypeScript`
- `Vercel`



<br>


## <font color="Seablue">開発ログ</font>

```terminal
$ cd ~/workspace/create
$ npx create-next-app@latest --typescript
$ npm run dev
$ git remote add origin git@github.com:******/cat_app.git
$ git branch -M main
$ git push -u origin main
$ git checkout -b development
$ git add .
$ git commit -m "【Add】ファイルシステムルーティングを確認"
$ git push
$ git push --set-upstream origin development
$ git log
$ プルリクエスト
$ リモートでマージ
$ git checkout main
$ git pull origin main
$ git checkout development
$ Vercelへデプロイ
$ デプロイ先本番環境のサーバーからWebページを確認
```

<br>

### ***<font color="orange">`index.tsx`のコードを紐解く</font>***

```tsx
// ~/pages/index.tsx
// 全部は調べ切らなくて良いだろう。ひとまず、コード序盤の内容を調べました。
// Next.js アプリケーション内の React コンポーネントにおいて、HTML の <head> 要素を操作するために使用される特別なコンポーネント
import Head from 'next/head'
// Next.js アプリケーション内の React コンポーネントにおいて、HTML の <image> 要素を操作するために使用される特別なコンポーネント
import Image from 'next/image'
// Next.js アプリケーション内の React コンポーネントにおいて、googleフォントの「Inter」を適用するためのコンポーネント
import { Inter } from 'next/font/google'
// Next.js アプリケーション内の React コンポーネントにおいて、CSS Modulesを導入するための記述
import styles from '@/styles/Home.module.css'
// 定数interに対してInterフォントのサブセットで`latin`を指定している。Googleフォントに関する記述だと思われる。
const inter = Inter({ subsets: ['latin'] })

```

- ***オブジェクトのサブセットを得る***
`オブジェクトのサブセットを得る方法です。サブセットとは、あるオブジェクトのいち部分を切り取ったもので、ここで紹介する方法は、プロパティ名を指定してオブジェクトの一部分を切り出すものです。たとえば、次のような数多くのプロパティを持つオブジェクトがあるとき、ここから数個のプロパティだけを持つオブジェクトを作る方法です。`

https://typescriptbook.jp/tips/get-a-subset-of-an-object


<br>

- ***JavaScriptとTypeScriptの大きな違いは`型が付いていない・付いている`である。***

```tsx
// これは動画で紹介されている古いバージョンのNext.jsホーム画面のtsxファイルのソースコード

import type { NextPage } from 'next'
import Head from 'next/head' import Image from 'next/image'
import styles from '../styles/Home.module.css'

const Home: NextPage = () => {
    return (
    <div className={styles.container}>
        <Head>
            <title>Create Next App</title> <meta name="description" content="Generated by create next app" /> <link rel="icon" href="/favicon.ico" />
        </Head>
    <main className={styles.main}>
        <h1 className={styles.title}>
            Welcome to <a href="https://nextjs.org">Next.js!</a>
        </h1>
    <p className={styles.description}>
        Get started by editing{''} <code className={styles.code)>pages/index.tsx</code>
    </p>
    
// ...以下略
```

- 上記のコード例で言うと、、、
- `const Home:`の`Home`は`Home`という名前をつけた関数コンポーネントである。
- `NextPage`は型である。
- 上の行の`import type { NextPage }`によって、NextPageという型が挿入されている。
- 関数コンポーネント`Home`は、`Next.js`公式が用意した`NextPage`で定義してますよ。ということを明確に示すための記述である。
- Next.jsとTypeScriptを用いて開発する際は、概ね、`NextPage`という型を指定してあげることになる。
- ただし、これはおそらくバージョン12以前のindexページの実装なので、バージョン14の2024/01/07時点では、また、少し違った型が定義されているのかなぁと思われる。
- まぁ、とりあえずは、こんなものがあるんだなぁ、くらいの感覚で認識しておく程度で良いでしょう。とのこと。
- 型をつける事により、VScode上（エディタ）でエラーをいち早く察知できるようになるのがメリットらしい。
- 以下のようなエラー表記が確認できるようになる。


<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3486945/c8497a06-12c7-a47a-ec92-f4dbdf4d1c6c.jpeg" alt="代替テキスト" width=50% height=50%>



<br>
<hr>


### ***<font color="orange">`index.tsx`に実装開始</font>***

***<font color="Red">動画05分20秒付近から</font>***

- 今回は`index.tsx`のページのコードの大部分を削除してしまって、ここにアプリケーション機能を実装していきます。
- ここまで削除してしまいます。

```tsx
// ~/pages/index.tsx

import Head from 'next/head'
import Image from 'next/image'
import { Inter } from 'next/font/google'
import styles from '@/styles/Home.module.css'

const inter = Inter({ subsets: ['latin'] })

export default function Home() {
  return (
    <>
    </>
  )
}
```

- 上記まで不要なコードを削ぎ落としたら、
- 最低限の見た目を作るための雛形を作っていきます。
- `export default function Home() {}`配下にCSSを当てていきます。


```tsx
export default function Home() {
  return (
    <div className={styles.container}>
      <h1>猫画像アプリ</h1>
    </div>
  );
};
```
- ここまでの実装で、`localhost:3000`で確認するとこんな感じ。

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3486945/73186494-1ed3-bb67-7867-23f9376a6983.jpeg" alt="代替テキスト" width=50% height=50%>

- どんどん実装していきます。
- ここまで実装して、再度ブラウザを確認します。

```tsx
export default function Home() {
  return (
    <div className={styles.container}>
      <h1>猫画像アプリ</h1>
      <img src="" alt="" />
      <button>今日の猫さん</button>
    </div>
  );
};
```

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3486945/0dac6f4e-dabd-860f-c743-a33eaf72ae03.jpeg" alt="代替テキスト" width=50% height=50%>

- imgタグには、猫画像を取得するAPIで取得した画像を載せるようにしていきますが、
- まだ実装段階ではないので、一旦タグだけ設置しておいています。
- また、`styles.container`のプロパティ名？は、まだ`Home.module.css`には実装されていないので、スタイルは当たっていない状態。
- 後程、`Home.module.css`にスタイルのコードを記述する必要がありあそうです。


### ***<font color="orange">猫画像を取得するAPIの確認とスタイルの調整</font>***

***<font color="Red">動画06分05秒付近から</font>***

- 今回使用するAPIは`the cat api`

https://thecatapi.com/

- 公式サイトのドキュメントメニューに進む。
- ここのリンクを開くと、ランダムで猫画像が保存されたURLが表示される。
- そのURLにアクセスすると猫画像が見れる。
- リロードすると、自動的にまたランダムの猫画像が取得される。
- https://api.thecatapi.com/v1/images/search
- 今回はこちらの画像を使用させてもらいます。
- https://cdn2.thecatapi.com/images/1v1.jpg


```json
[
    {
        "id":"1v1",
        "url":"https://cdn2.thecatapi.com/images/1v1.jpg",
        "width":320,
        "height":320
    }
]
```

- 一旦、この画像をトップに置いておきます。
- 教材動画では`index.tsx`に直接スタイルを記述していますが、
- 自分のコード上では`<div className={styles.container}>`が定義されています。
- せっかくなのでこれを利用します。
- `Home.module.css`ファイルに新しく`.container`を定義して、ここにCSSスタイルを適用していきます。
- スタイルは結構適当です。


```css
/* Home.module.css */

.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
}

.container h1 {
  margin-bottom: 15px;
}

.container img {
  width: 350px;
  height: auto;
}

.container button {
  margin-top: 20px;
}

```

- 以下、`index.tsx`に任意の画像を乗っけたファイルのコードです。

```tsx
// index.tsx

export default function Home() {
  return (
    <div className={styles.container}>
      <h1>猫画像アプリ</h1>
      <img src="https://cdn2.thecatapi.com/images/1v1.jpg" alt="cat_image" />
      <button>今日の猫さん</button>
    </div>
  );
};
```

- 一旦、`localhost:3000`でWebブラウザを確認します。

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3486945/5f15836d-c07c-eca3-f1bd-1ab19cf2ec8c.jpeg" alt="代替テキスト" width=50% height=50%>

- 見た目はいい感じに収まりました。
- ここで一旦、コミットしておきます。


### ***<font color="orange">いよいよAPIを叩いていく！</font>***

***<font color="Red">動画08分47秒付近から</font>***

- `button`を押したときに、APIが走るようにしたい。
- TypeScriptの`onClick`イベントが発火するように実装する。
- 具体的には、、、、
    - まず`index.tsx`の`<button>`タグに`onClick=`のイベントを定義。
    - この`onClick`イベントには任意の関数名`fetchCatImage`といった名前をつける。
    - 次に、定義づけた関数`fetchCatImg`の処理について、`export default function Home() {}`の直下に実装していく。


<br>

***メモ***

- `async`は非同期処理でAPIを実装するときに使うおまじない。アロー関数の手前に定義する。
- `await`の`fetch`という関数が備わっているやつを使用している。
- これも一旦おまじないと思っておく。奥が深そう。
- URLは`the cat api`が指定しているAPIのURLを使用している。
- `fetch`は日本語だと`読み込む`とか`取ってくる`みたいな意味。
- これら自体は`JavaScript`の構文。
- 当然、`TypeScript`でも使える。
- `const res`を手前につけてあげて、叩いたAPI情報を受け取ることができる。
- さらに受け取った情報をJSON形式で受け取りたいので、`const result`定数で`res.json();`としてあげる。
- ここにも忘れずに`await`をつけてあげる。
- そして、受け取ったJSONファイルを`console.log`で出力する。
- 一度デベロッパーツールで確認するとわかるが、JSON形式の取得したファイルは、配列の0番目の要素の中にハッシュ形式で4つの属性（プロパティ）全てが格納されている。
- よって今回は、配列の0番目の値を取ってくるので、`console.log(result[0]);`としてあげる。


https://zenn.dev/kawaxumax/articles/0044a0e30536e2

https://qiita.com/niusounds/items/37c1f9b021b62194e077


- ここまで実装したら、ローカルのブラウザ環境で試してみる。
- そうすると以下の画像のように、ボタンを押すとAPIが動いて、情報が出力されたことがわかる。

<br>

```tsx
// index.tsx
import Head from 'next/head'
import Image from 'next/image'
import { Inter } from 'next/font/google'
import styles from '@/styles/Home.module.css'

const inter = Inter({ subsets: ['latin'] })

export default function Home() {
  const fetchCatImage = async () => {
    const res = await fetch("https://api.thecatapi.com/v1/images/search");
    const result = await res.json();
    console.log(result[0]);
  };
  return (
    <div className={styles.container}>
      <h1>猫画像アプリ</h1>
      <img src="https://cdn2.thecatapi.com/images/1v1.jpg" alt="cat_image" />
      <button onClick={fetchCatImage}>
        今日の猫さん
      </button>
    </div>
  );
};
```

<br>

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3486945/d577ddc4-d642-aadd-fcdd-c5882811093a.jpeg" alt="代替テキスト" width=50% height=50%>

- いったん、ここまで。
- ここまでのコードは`JavaScript`である。
- まだ`TypeScript`は使っていない。

<br>

***<font color="Red">動画10分00秒付近から</font>***

- 先の実装では`fetchCatImage`関数のなかで`console.log`で出力していたが、のちに実装する`handleClick`に対応するために、、、
- このコードをコメントアウトし、新たに`return result[0]`としてAPI取得した要素をブラウザに表示させるようにします。

```tsx
export default function Home() {
  const fetchCatImage = async () => {
    const res = await fetch("https://api.thecatapi.com/v1/images/search");
    const result = await res.json();
    // console.log(result[0]);
    return result[0];
  };
```


<br>

- 続いて、先ほどの実装では`fetchCatImage`関数を`onClick`でAPIを呼び出していたが、
- 今度は新しく`handleClick`という関数を作り、その処理の中で`fetchCatImage`を呼び出すように変更します。
- これは詳しくは今の所不明だけれど、そうするもんだと思っておこう。。。。
- この記事が参考になるかも？

https://qiita.com/jima-r20/items/839da7c2f26366491298

- `handleClick`という関数を別で用意する意味としては、メソッドが増えたときに構文が長くならないようにするための処置なのかなぁ、、、？
- ここまでのコード実装は以下の通り。

```tsx
export default function Home() {
  const fetchCatImage = async () => {
    const res = await fetch("https://api.thecatapi.com/v1/images/search");
    const result = await res.json();
    // console.log(result[0]);
    return result[0];
  };

  const handleClick = async () => {
    const catImage = await fetchCatImage();
    console.log(catImage);
  };

  return (
    <div className={styles.container}>
      <h1>猫画像アプリ</h1>
      <img src="https://cdn2.thecatapi.com/images/1v1.jpg" alt="cat_image" />
      <button onClick={handleClick}>
        今日の猫さん
      </button>
    </div>
  );
};
```
- 上記のように実装すると、先のコードと結果が同じになる。
- つまり、うまく挙動を変えずにリファクタリング(?)できたことになる。


<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3486945/61a0507c-eb46-651c-4f92-4420b7a85139.jpeg" alt="代替テキスト" width=50% height=50%>

- 結果は同じで、中身のコードをきれいにできた。
- 汎用性の高いコードにできた？とでもいうべきかな？
- ここで一旦コミットしておきたい。


***<font color="Red">動画11分30秒付近から</font>***

- ここまではJavaScriptの実装。
- このままでも良いのだが、、、、
- 例えば`<button onClick={handleClick.alt}>`のように存在しないプロパティ`alt`を指定すると、エラーになる。
- なぜなら、`alt`プロパティは定義していないから。
- JavaScriptだとここのエラーに気づきづらいのがデメリット。
- js？html？にコンパイルされた時点でエラーが発覚してくれると、気づきやすい。
- ここを解消してくれるのがTypeScriptということになる。
- では、次にTypeScriptでの実装をおこなっていく。

<br>

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3486945/58bfa402-84dc-c85e-a9c8-d3af95d0d736.jpeg" alt="代替テキスト" width=50% height=50%>

<br>

### ***<font color="orange">TypeScriptを用いた実装！</font>***

***<font color="Red">動画13分20秒付近から</font>***

- 関数コンポーネントの外側、上に追記していきます。
- `interface`というメソッド?を使用します。
- 名前は`SearchCatImage`とします。（任意）
- `height` `id`  `url` `width`という4つのプロパティだけを、`型指定`してあげる。
- 次に、`fetchCatImage`関数に対して、`Promise`メソッド？を用いて、対象を`SearchCatImage`に指定してあげる。
- そうすることで、`SearchCatImage`で指定した4つのプロパティの型だけを取得するように制限をかけられると共に、`VScode`などのテキストエディタ上での実装の段階で、エラーのポップアップが表示されるようになる！
- これは便利！

```diff_tsx
+ interface SearchCatImage {
+   id: string;
+   url: string;
+   width: number;
+   height: number;
+ }

export default function Home() {
+ const fetchCatImage = async (): Promise<SearchCatImage> => {
    const res = await fetch("https://api.thecatapi.com/v1/images/search");
    const result = await res.json();
    // console.log(result[0]);
    return result[0];
  };
```

- すると、エラーが`VScode`の実装段階で気づけるようになった！

<br>

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3486945/b03dd876-684a-c66a-2c52-a98a5494c718.jpeg" alt="代替テキスト" width=50% height=50%>

<br>


- エラーに気づきやすくなったところで、
- 次に、取得する情報をurlに限定してあげる。

```diff_tsx
  const handleClick = async () => {
    const catImage = await fetchCatImage();
+   console.log(catImage.url);
  };
```

- TypeScriptの重要項目の実装はいったん、ここまで。
- コミットしておきます。

<br>


### ***<font color="orange">取得した猫画像URLを画面に出力</font>***

***<font color="Red">動画16分20秒付近から</font>***











<br><br><br><br><br><br><br>


## <font color="Seablue">よく使うタグ</font>

`## <font color="seablue">シーブルー</font>`

`#### <font color="salmon">サーモンピンク</font>`

`<img src="" alt="代替テキスト" width=50% height=50%>`

`<a href="" target="_blank">テキスト</a>`

`***<font color="Red">動画05分20秒付近から</font>***`

<br><br><br><br>
